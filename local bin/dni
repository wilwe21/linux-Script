#!/usr/bin/env python
import os, argparse, yaml
from pathlib import Path
parser = argparse.ArgumentParser()
parser.add_argument("-r", "--reset", help="Reset", action=argparse.BooleanOptionalAction)
parser.add_argument("-i", "--info", help="Show info", action=argparse.BooleanOptionalAction)
parser.add_argument("-a", "--add", help="Add value", action=argparse.BooleanOptionalAction)
parser.add_argument("-v", "--value", help="Value to add", default=1)
args = parser.parse_args()
format="%Y-%m-%d"
td = os.popen(f'date +"{format}"').read()
try:
    with open(f"{Path.home()}/.config/dni.yaml", "r") as f:
        dat = yaml.load(f, Loader=yaml.FullLoader)
    path = dat["path"]
except Exception as e:
    print(e)
    print("No path or config file")
    exit()
try:
    with open(path, "r+") as f:
        dni = yaml.load(f, Loader=yaml.FullLoader)
    if args.info != None:
        if dni["data"] != td.strip():
            print(f"Nie było dni teraz dzień {dni['dzień'] + 1}")
        else:
            print(f"Był dzień {dni['dzień']}")
    if args.add != None:
        sav = {"dzień": dni["dzień"]+int(args.value), "data": td.strip()}
        with open(path, "w") as f:
            yaml.dump(sav, f, sort_keys=False, allow_unicode=True)
        print(sav)
    if args.reset !=None:
        with open(path, "w") as f:
            yaml.dump({"dzień": 0,"data": td.strip()}, f)
except Exception as e:
    print(e)
    pass
